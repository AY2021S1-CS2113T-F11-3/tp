@startuml
!include style.puml

box Logic LOGIC_COLOR_T1
participant ":ReviseCommand" as ReviseCommand LOGIC_COLOR
participant ":Scheduler" as Scheduler LOGIC_COLOR
participant ":HistoryCommand" as HistoryCommand LOGIC_COLOR
end box

box Model MODEL_COLOR_T1
participant ":Access" as Access MODEL_COLOR
participant ":Module" as Module MODEL_COLOR
participant ":Chapter" as Chapter MODEL_COLOR
participant ":ChapterList" as ChapterList MODEL_COLOR
end box

box Ui UI_COLOR_T1
participant ":Ui" as Ui UI_COLOR
end box

box Storage STORAGE_COLOR_T1
participant ":Storage" as Storage STORAGE_COLOR
end box

[-> ReviseCommand : execute(ui, access, storage)
activate ReviseCommand
ReviseCommand -> ReviseCommand : getChapter(reviseIndex, access)
activate ReviseCommand
ReviseCommand -> Access : getModule()
activate Access
ReviseCommand <-- Access : module
deactivate Access
[<-[hidden]- Access
destroy Access
ReviseCommand -> Module : getChapters()
activate Module
ReviseCommand <-- Module : chapters
deactivate Module
[<-[hidden]- Module
destroy Module
ReviseCommand -> ChapterList : getChapter()
activate ChapterList
ReviseCommand <-- ChapterList : chapter
deactivate ChapterList
[<-[hidden]- ChapterList
destroy ChapterList
ReviseCommand <-- ReviseCommand : toRevise
deactivate ReviseCommand
opt chapter not due
    ReviseCommand -> ReviseCommand : promptNotDue(ui, toRevise)
    activate ReviseCommand
    ReviseCommand -> Ui : getInput()
    activate Ui
    ReviseCommand <-- Ui : input
    deactivate Ui
    loop input is invalid
        alt user enters Y
        else user enters N
        else invalid input
            ReviseCommand -> Ui : getInput()
            activate Ui
            ReviseCommand <-- Ui : input
            deactivate Ui
        end
    end
    ReviseCommand --> ReviseCommand : notRevising
    deactivate ReviseCommand
    opt notRevising
        <--  ReviseCommand
    end
end
ReviseCommand -> ReviseCommand : getCards(ui, access, storage)
activate ReviseCommand
ReviseCommand -> Storage : loadCard(module, chapter)
activate Storage
ReviseCommand <-- Storage
deactivate Storage
ReviseCommand <-- Storage : allCards
ReviseCommand -> Chapter : setCards(allCards)
activate Chapter
ReviseCommand <-- Chapter
deactivate Chapter
ReviseCommand --> ReviseCommand : allCards
deactivate ReviseCommand
ReviseCommand -> Ui : showToUser(cardCount)
activate Ui
ReviseCommand <-- Ui
deactivate Ui
opt no cards
    ReviseCommand -> Ui : showToUser(message)
    activate Ui
    ReviseCommand <-- Ui
    deactivate Ui
    [<-- ReviseCommand
end
ReviseCommand -> Ui : showToUser(message)
activate Ui
ReviseCommand <-- Ui
deactivate Ui
loop all cards
    ReviseCommand -> ReviseCommand : reviseCard(count, c, ui, repeatCards)
    activate ReviseCommand
    ReviseCommand -> ReviseCommand : rateCard(ui, repeatCards, c, input)
    activate ReviseCommand
    deactivate ReviseCommand
    ReviseCommand --> ReviseCommand : count
    deactivate ReviseCommand
end
ReviseCommand -> ReviseCommand : repeatRevision(ui, repeatCards, count)
activate ReviseCommand
deactivate ReviseCommand
ReviseCommand -> Ui : showToUser(message)
activate Ui
ReviseCommand <-- Ui
deactivate Ui
[<-[hidden]- Ui
destroy Ui
ReviseCommand -> Scheduler : computeDeckDeadline(cards)
activate Scheduler
ReviseCommand <-- Scheduler : date
deactivate Scheduler
[<-[hidden]- Scheduler
destroy Scheduler
ReviseCommand -> Chapter : setDueBy(date, storage, access)
activate Chapter
ReviseCommand <-- Chapter
deactivate Chapter
[<-[hidden]- Chapter
destroy Chapter
ReviseCommand -> Storage : saveCards(cards, module, chapter)
activate Storage
ReviseCommand <-- Storage
deactivate Storage
[<-[hidden]- Storage
destroy Storage
ReviseCommand -> HistoryCommand : addHistory(ui, access, storage, reviseIndex)
activate HistoryCommand
ReviseCommand <-- HistoryCommand
deactivate HistoryCommand
[<-[hidden]- HistoryCommand
destroy HistoryCommand
[<-- ReviseCommand
deactivate ReviseCommand
@enduml